<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survival Probability Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input, button {
            margin-bottom: 15px;
        }

        button {
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        #plqContainer {
            display: flex;
            align-items: center;
            flex-direction: row; /* 将子元素水平排列 */
        }

        #result {
            margin-top: 15px;
            align-self: flex-end;
        }
    </style>
</head>
<body>
    <h1>ADI心血管风险预测</h1>

    <label for="leftABI">左侧ABI: </label>
    <input type="number" id="leftABI" step="0.1" required>

    <label for="rightABI">右侧ABI: </label>
    <input type="number" id="rightABI" step="0.1" required>

    <label for="pwv">脉搏波速度: </label>
    <input type="number" id="pwv" step="0.1" required>

     <div id="plqContainer">
        <label for="plqYes">颈动脉斑块:</label>
        <input type="radio" id="plqYes" name="plq" value="1">
        <label for="plqYes">有</label>

        <input type="radio" id="plqNo" name="plq" value="0">
        <label for="plqNo">无</label>
    </div>


    <label for="pp">脉压差: </label>
    <input type="number" id="pp" step="0.1" required>

    <label for="cimt">颈动脉内中膜厚度: </label>
    <input type="number" id="cimt" step="0.1" required>

    
    <label for="time">时间 (年): </label>
    <input type="number" id="time" min="0"  max="8.26" step="0.01" required>

    <button onclick="calculateSurvival()">计算</button>

    <div id="result"></div>

    <script>
        function calculateSurvival() {
             var time = parseFloat(document.getElementById("time").value);
             var abiLeft = parseFloat(document.getElementById("leftABI").value);
             var abiRight = parseFloat(document.getElementById("rightABI").value);
             var PWV = parseFloat(document.getElementById("pwv").value);
             var plq = parseInt(document.querySelector('input[name="plq"]:checked').value);
             var pp = parseFloat(document.getElementById("pp").value);
             var cimt = parseFloat(document.getElementById("cimt").value);
             var abi2;
        if (abiLeft >= 0.9 && abiRight >= 0.9) {
            abi2 = 0;
        } else if (abiLeft < 0.9 && abiRight < 0.9) {
            abi2 = 2;
            } else {
            abi2 = 1;
        }
             var pwv2;
        if (PWV <= 8.2) {
            pwv2 = 0;
        } else if (PWV > 8.2 && PWV <= 9.9) {
            pwv2 = 1;
        } else {
            pwv2 = 2;
        }

       // 根据 PP 计算 pp2
       var pp2;
        if (pp >= 60) {
        pp2 = 1;
        } else {
       pp2 = 0;
       }

     // 根据 CIMT 计算 cimt2
        var cimt2;
        if (cimt > 0.9) {
      cimt2 = 1;
        } else {
       cimt2 = 0;
      }

     // 计算 ADI
     var pwvMap = { 0: 0, 1: 2, 2: 4 };
     var abiMap = { 0: 0, 1: 4, 2: 5 };
     var adi = pwvMap[pwv2] + cimt2 * 2 + plq * 1 + abiMap[abi2] + pp2 * 2;

     var baselineData = {
            "hazard":[0.000131268542526564,0.000262598137434386,0.000394053664765807,0.00065708271117422,0.000788646273360299,0.000920271162724629,0.00105193881704941,0.00118375814444739,0.00131562036326565,0.00144763470400002,0.00157969206317627,0.00171187675503149,0.0018440914954432,0.00197641276082867,0.00210882307729422,0.00224126354499463,0.00237374730934775,0.00250624862797435,0.00263879328305536,0.00277140018359674,0.00290406938808921,0.00303676886184838,0.00316948594709492,0.00330238768773275,0.00343535200975007,0.00356833401362938,0.00370134642969407,0.0038343765404152,0.00396742435050124,0.00410053487963853,0.00423370818698677,0.00436695678018346,0.00450036071275796,0.00463378596894925,0.00476731971046119,0.00490090618450854,0.00516824270008839,0.00530196664555693,0.00543572134355194,0.00556951290147826,0.0057033352430402,0.00583718329146323,0.00597125640719857,0.00610539321260422,0.00623955157657757,0.00637374089323171,0.00664221918494656,0.00677651493872556,0.00691087459392345,0.0070452982113811,0.00717985376787893,0.00731447347333567,0.00744920361597518,0.00758412406222455,0.00785412047754059,0.00798928672150856,0.00812451769818371,0.00825980275666246,0.00839513299195808,0.00853050096079058,0.00866588725659095,0.00880133849609153,0.00893690154187658,0.00907252970108435,0.00920831880069071,0.00934414589018994,0.00947999946260746,0.00961587952827232,0.00975179134626312,0.00988772163878709,0.0100236740702816,0.0101596721254899,0.0102957828919028,0.0104319318284332,0.0105681464425672,0.0107044068565839,0.0108407131012925,0.010977132568834,0.0111136466909599,0.0112501928624695,0.0113867613740371,0.0115233759238209,0.0116600853991924,0.011796841007885,0.0120704450965042,0.0122073059313108,0.0123442331325168,0.0124812267645178,0.0126182590634843,0.012755337713943,0.0128924627472617,0.0130296201174868,0.0131668731694117,0.0133041929687606,0.013441579580485,0.0135790220122814,0.0137165110734892,0.0138540671119214,0.0139916698568955,0.014129471112954,0.0142672951216761,0.0144051660191246,0.0145431527547882,0.0146811864899843,0.0148193171339321,0.0149576147157696,0.0150959688605385,0.0152343796145256,0.0153729579845542,0.0155115593646133,0.0156503288230101,0.01578916651223,0.015928072499402,0.0160670116690079,0.0162060079276824,0.0163450518762292,0.0164841530000007,0.0166233018856428,0.0167625080328606,0.0169018556793346,0.0170412607511203,0.0171807137937683,0.0173202069044028,0.0174597480465196,0.0175993171398013,0.0177389552527036,0.0178786268987903,0.0180183676659887,0.0182980478603202,0.0184380414904562,0.0185780688247649,0.0187181445592212,0.0188582540374005,0.0189984039617262,0.0191386234814754,0.0192790150294601,0.0194194471866319,0.0195599796507364,0.0197005705210379,0.0198413057211227,0.0199820646531283,0.020122843401,0.0202636629824005,0.0204046273637951,0.0206867115241505,0.0208279154377388,0.0209691604319069,0.0211105068979633,0.0212519241531697,0.0213934431280128,0.0215350213321042,0.0216766490145793,0.0218183360173506,0.0219601696104184,0.0219601696104184,0.0221031200101053,0.0221031200101053,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0222487666571975,0.0224096165495732,0.0225706928556649,0.0227332984555346,0.0227332984555346,0.0227332984555346,0.0229007747309037,0.0230682912705002,0.0232359788512066,0.0234037243705926,0.0235715036065443,0.0239072420715407,0.0240752073363562,0.0242432560422291,0.0244114048190986,0.0245797600942995,0.0247482158060558,0.0249167203223113,0.025085397904196,0.0252542832860753,0.0254232028443446,0.0255923307996034,0.025761560115734,0.0259308386857114,0.0261002919158059,0.0262698160305658,0.0264394251427596,0.0266091361935483,0.0267789183449119,0.0269487716564504,0.0272888771632255,0.0274590880896534,0.0276293705362079,0.0277997557325848,0.0279702125956453,0.0281408172650679,0.0283114937859595,0.0284822422188672,0.0286532035886226,0.028824313641351,0.0289954959719613,0.0291667506415404,0.0293380404532547,0.0295094795200239,0.0296809691355168,0.0296809691355168,0.0296809691355168,0.0296809691355168,0.0296809691355168,0.0296809691355168,0.0296809691355168,0.0298643232511494,0.0298643232511494,0.0298643232511494,0.0300561755365982,0.0300561755365982,0.0300561755365982,0.0300561755365982,0.0302623269739664,0.0302623269739664,0.0302623269739664,0.0302623269739664,0.0304858798534178,0.0307136539158685,0.0309416919755232,0.0311697923494499,0.0313982728876629,0.0316270717319699,0.0318559998242891,0.0320850359156193,0.0323142271838738,0.0327732596487654,0.0330033630306554,0.0332336540758641,0.0336948541804119,0.0341567388679385,0.034387953580768,0.0346196364162123,0.035083351749035,0.0353155733473721,0.0355478723666366,0.0357805004279428,0.036013523908575,0.0362469441550833,0.0364804989251113,0.0367143312705877,0.0369485631435682,0.0371829080789822,0.0374174476628966,0.0376521499734534,0.0378869470325646,0.0381218389167603,0.0383568670265708,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0385920909219086,0.0388411531356194,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0390916248504758,0.0393572188444396,0.0396229870159525,0.0398890055643477,0.0401551257137613,0.0404213676826851,0.0406877846803636,0.0409543237695376,0.0412210382784697,0.0417553221953938,0.0420226604766524,0.0422901460496128,0.0425578852473399,0.0428256961485427,0.0430939444783624,0.0433624478821639,0.0436311293016983,0.0438999594970852,0.0441688934529757,0.044438083789044,0.0447074530531757,0.0449772648556417,0.0452471811778846,0.0455174683022642,0.0457879059865487,0.0460584943985664,0.0463291560484902,0.0466000344320027,0.0468710390312746,0.0471423039758064,0.0474136571028968,0.0476855484083782,0.0479576222517674,0.0482298486527394,0.0485022580419896,0.0487748203654557,0.0490475357949528,0.0493203256184437,0.0495934941866777,0.0498667521796735,0.0501402748675668,0.0504139822911851,0.0506882372817455,0.0509626216550886,0.0509626216550886,0.0509626216550886,0.0509626216550886,0.0509626216550886,0.0509626216550886,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0512424157791118,0.0515383470328614,0.0515383470328614,0.0515383470328614,0.0518422509644868,0.0521471248722804,0.0524521586735701,0.0527573039835868,0.0530629232901831,0.0533688737364533,0.0536751560407579,0.0539816316908197,0.0542883392893276,0.0545952087110129,0.0552095477867594,0.0555173361865156,0.0558256068361734,0.0561340139331242,0.0564436185713776,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0567538079678301,0.0573087003948782,0.0584212383642917,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.058978905013713,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164,0.0604631602098164],
            "time":[0.00273972602739726,0.0273972602739726,0.0328767123287671,0.101369863013699,0.164383561643836,0.180821917808219,0.191780821917808,0.254794520547945,0.293150684931507,0.30958904109589,0.317808219178082,0.320547945205479,0.380821917808219,0.389041095890411,0.408219178082192,0.419178082191781,0.449315068493151,0.473972602739726,0.479452054794521,0.556164383561644,0.572602739726027,0.575342465753425,0.591780821917808,0.613698630136986,0.627397260273973,0.638356164383562,0.649315068493151,0.654794520547945,0.684931506849315,0.695890410958904,0.717808219178082,0.772602739726027,0.783561643835616,0.832876712328767,0.906849315068493,0.953424657534247,0.96986301369863,0.994520547945206,1.00547945205479,1.01095890410959,1.07671232876712,1.09315068493151,1.1041095890411,1.12876712328767,1.13698630136986,1.16712328767123,1.2,1.20547945205479,1.23013698630137,1.23835616438356,1.32876712328767,1.34246575342466,1.36164383561644,1.36438356164384,1.39178082191781,1.3972602739726,1.47945205479452,1.48219178082192,1.50958904109589,1.51232876712329,1.51780821917808,1.52602739726027,1.53424657534247,1.53972602739726,1.54520547945205,1.55068493150685,1.55616438356164,1.5972602739726,1.64109589041096,1.67671232876712,1.68767123287671,1.6958904109589,1.70684931506849,1.72328767123288,1.73698630136986,1.79452054794521,1.80821917808219,1.82465753424658,1.84657534246575,1.88767123287671,1.93150684931507,1.93698630136986,1.94520547945205,1.97808219178082,2.00547945205479,2.01917808219178,2.05479452054795,2.05753424657534,2.06301369863014,2.08493150684932,2.08767123287671,2.0986301369863,2.14246575342466,2.14794520547945,2.15616438356164,2.16438356164384,2.18904109589041,2.19178082191781,2.22739726027397,2.26027397260274,2.28219178082192,2.33424657534247,2.34246575342466,2.35068493150685,2.36164383561644,2.40547945205479,2.46849315068493,2.47397260273973,2.4958904109589,2.5041095890411,2.52602739726027,2.53150684931507,2.55890410958904,2.62465753424658,2.64657534246575,2.65479452054795,2.66301369863014,2.67123287671233,2.70684931506849,2.77534246575342,2.77808219178082,2.8,2.82191780821918,2.84931506849315,2.86027397260274,2.86849315068493,2.87671232876712,2.9013698630137,2.90958904109589,2.91506849315068,2.91780821917808,2.95890410958904,2.97260273972603,2.98630136986301,2.99178082191781,3.00547945205479,3.05479452054795,3.06301369863014,3.07123287671233,3.07945205479452,3.16438356164384,3.18082191780822,3.18356164383562,3.21917808219178,3.24109589041096,3.24657534246575,3.32602739726027,3.32876712328767,3.33424657534247,3.33698630136986,3.34520547945205,3.36986301369863,3.38356164383562,3.38904109589041,3.39178082191781,3.39452054794521,3.3972602739726,3.4027397260274,3.40547945205479,3.40821917808219,3.41095890410959,3.41369863013699,3.41643835616438,3.42465753424658,3.42739726027397,3.43561643835616,3.43835616438356,3.44383561643836,3.44657534246575,3.44931506849315,3.45205479452055,3.5013698630137,3.5041095890411,3.50958904109589,3.51232876712329,3.51506849315069,3.55616438356164,3.57260273972603,3.58082191780822,3.5972602739726,3.6027397260274,3.64931506849315,3.66301369863014,3.68493150684932,3.69041095890411,3.73424657534247,3.73972602739726,3.76164383561644,3.76712328767123,3.79178082191781,3.81917808219178,3.86301369863014,3.86575342465753,3.88493150684931,3.91780821917808,3.96438356164384,3.97534246575342,4.06575342465753,4.08767123287671,4.13424657534247,4.15068493150685,4.18356164383562,4.2,4.20547945205479,4.22465753424658,4.27123287671233,4.28219178082192,4.28493150684931,4.29041095890411,4.2986301369863,4.36712328767123,4.36986301369863,4.37260273972603,4.37534246575343,4.38356164383562,4.38630136986301,4.38904109589041,4.39178082191781,4.39452054794521,4.4027397260274,4.40547945205479,4.40821917808219,4.41095890410959,4.41369863013699,4.42191780821918,4.42465753424658,4.42739726027397,4.43013698630137,4.49315068493151,4.4958904109589,4.4986301369863,4.51232876712329,4.52054794520548,4.52328767123288,4.54246575342466,4.5972602739726,4.65479452054795,4.73424657534247,4.74246575342466,4.76164383561644,4.83287671232877,4.84657534246575,4.88219178082192,4.9041095890411,4.91232876712329,4.94520547945205,4.96164383561644,5,5.10684931506849,5.11780821917808,5.17808219178082,5.22739726027397,5.26301369863014,5.27397260273973,5.27671232876712,5.28219178082192,5.29041095890411,5.33424657534247,5.35068493150685,5.36438356164384,5.36712328767123,5.36986301369863,5.37260273972603,5.38082191780822,5.38356164383562,5.38630136986301,5.38904109589041,5.39178082191781,5.39452054794521,5.4,5.4027397260274,5.40547945205479,5.41643835616438,5.41917808219178,5.42191780821918,5.42465753424658,5.42739726027397,5.44657534246575,5.45205479452055,5.47397260273973,5.48767123287671,5.51780821917808,5.55342465753425,5.55890410958904,5.57260273972603,5.58082191780822,5.58904109589041,5.6,5.62191780821918,5.66027397260274,5.66301369863014,5.67945205479452,5.69315068493151,5.73698630136986,5.75890410958904,5.76438356164384,5.79178082191781,5.79452054794521,5.84109589041096,5.84657534246575,5.88767123287671,5.91232876712329,5.93698630136986,5.94520547945205,5.95890410958904,5.96986301369863,6.02191780821918,6.06301369863014,6.10684931506849,6.18630136986301,6.18904109589041,6.2,6.21095890410959,6.23561643835616,6.26027397260274,6.29041095890411,6.3013698630137,6.31506849315068,6.31780821917808,6.32602739726027,6.36164383561644,6.36438356164384,6.36712328767123,6.36986301369863,6.37260273972603,6.38356164383562,6.38630136986301,6.38904109589041,6.3972602739726,6.4,6.4027397260274,6.40547945205479,6.40821917808219,6.41643835616438,6.41917808219178,6.42191780821918,6.42465753424658,6.44383561643836,6.49315068493151,6.4958904109589,6.51232876712329,6.52602739726027,6.58630136986301,6.67123287671233,6.7013698630137,6.78904109589041,6.84657534246575,6.8958904109589,6.93150684931507,7,7.05753424657534,7.10958904109589,7.20821917808219,7.22465753424658,7.22739726027397,7.23013698630137,7.23287671232877,7.24109589041096,7.24383561643836,7.24657534246575,7.24931506849315,7.25205479452055,7.26027397260274,7.26301369863014,7.26575342465753,7.26849315068493,7.27123287671233,7.27945205479452,7.28219178082192,7.28493150684931,7.28767123287671,7.32602739726027,7.4986301369863,7.50684931506849,7.55068493150685,7.55342465753425,7.55616438356164,7.56712328767123,7.56986301369863,7.57260273972603,7.57534246575342,7.57808219178082,7.58630136986301,7.58904109589041,7.59178082191781,7.59452054794521,7.5972602739726,7.60547945205479,7.60821917808219,7.61095890410959,7.61369863013699,7.89315068493151,8.1041095890411,8.10684931506849,8.10958904109589,8.11232876712329,8.11506849315069,8.12328767123288,8.12602739726027,8.12876712328767,8.13150684931507,8.14246575342466,8.14520547945206,8.14794520547945,8.15068493150685,8.15342465753425,8.16164383561644,8.16438356164384,8.16712328767123,8.16986301369863,8.17260273972603,8.18082191780822,8.18356164383562,8.18630136986301,8.18904109589041,8.19178082191781,8.2,8.2027397260274,8.20547945205479,8.20821917808219,8.21095890410959,8.21917808219178,8.22191780821918,8.22465753424657,8.22739726027397,8.23013698630137,8.24109589041096,8.24383561643836,8.24657534246575,8.24931506849315,8.25753424657534,8.26027397260274]};
        


             // 替换为实际 Cox 回归系数
             var coef = 0.1806475;

             // 计算相对风险
             var relativeRisk = Math.exp(coef * adi);

              
             // 找到最接近输入时间的索引
             var timeIndex = findClosestIndex(baselineData.time, time);
                    
             // 获取对应索引处的 hazard
             var predictedHazard = baselineData.hazard[timeIndex] * relativeRisk;
                    
             // 计算事件概率
             var predictedSurvivalProbability = 1 - Math.exp(-predictedHazard) ;

             // 显示结果
             var resultElement = document.getElementById("result");
                    resultElement.innerHTML = "<p> " + time + " 年心血管事件风险：" +(predictedSurvivalProbability.toFixed(9))*100+"%" + "</p>" +
                                              "<p>ADI: " + adi.toFixed(0) + "</p>"};
           
        // 辅助函数，找到最接近给定值的索引
        function findClosestIndex(arr, value) {
            var closestIndex = 0;
            var closestDiff = Math.abs(arr[0] - value);

            for (var i = 1; i < arr.length; i++) {
                var diff = Math.abs(arr[i] - value);
                if (diff < closestDiff) {
                    closestIndex = i;
                    closestDiff = diff;
                }
            }

            return closestIndex;
        }
    </script>
